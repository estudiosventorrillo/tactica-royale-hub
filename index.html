<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>T√°ctica Royale Fan-Hub v9.2.1</title>
    
    <link rel="icon" type="image/png" href="https://vectorseek.com/wp-content/uploads/2023/09/Clash-Royale-Icon-Logo-Vector.svg-.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Rubik', sans-serif;
            color: white;
            -webkit-tap-highlight-color: transparent;
            background-color: #1a1c29;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @media (orientation: portrait) { body { background-image: url('https://i.pinimg.com/736x/3b/ec/9a/3bec9a888fd77bb74349d7e6b02c32e8.jpg'); } }
        @media (orientation: landscape) { body { background-image: url('https://i.imgur.com/m72NFZ7.png'); } }

        .app-overlay { background: rgba(0, 0, 0, 0.65); position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; backdrop-filter: blur(2px); }

        .clash-btn { transition: all 0.1s; border-bottom-width: 6px; border-color: rgba(0,0,0,0.3); }
        .clash-btn:active { transform: translateY(4px); border-bottom-width: 2px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .selected-leader, .selected-mod { transform: scale(1.1); border: 4px solid #fbbf24 !important; box-shadow: 0 0 20px #fbbf24; z-index: 10; }
        
        .rank-1 { background: linear-gradient(to bottom, #fcd34d, #b45309); border-color: #78350f; }
        .rank-2 { background: linear-gradient(to bottom, #4ade80, #15803d); border-color: #052e16; }
        .rank-3 { background: linear-gradient(to bottom, #9ca3af, #4b5563); border-color: #1f2937; }
        .rank-4 { background: linear-gradient(to bottom, #f87171, #b91c1c); border-color: #450a0a; }

        .bg-elixir-2 { background: linear-gradient(to bottom right, #4ade80, #16a34a); border-color: #14532d; }
        .bg-elixir-3 { background: linear-gradient(to bottom right, #60a5fa, #2563eb); border-color: #1e3a8a; }
        .bg-elixir-4 { background: linear-gradient(to bottom right, #c084fc, #9333ea); border-color: #581c87; }
        .bg-elixir-5 { background: linear-gradient(to bottom right, #facc15, #ca8a04); border-color: #713f12; }

        .bar-container { height: 100%; display: flex; align-items: flex-end; justify-content: center; background: rgba(255,255,255,0.1); border-radius: 8px; position: relative; overflow: hidden; transition: background 0.3s; }
        .bar-container:hover { background: rgba(255,255,255,0.2); }
        .chart-grid { position: absolute; width: 100%; border-top: 1px dashed rgba(255,255,255,0.2); }
        
        .sticky-header { position: sticky; top: 0; z-index: 50; background-color: #1f232f; border-bottom: 2px solid #3d4658; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5); }
        .drop-shadow-strong { filter: drop-shadow(0px 0px 2px rgba(0,0,0,1)); }
        .text-shadow { text-shadow: 2px 2px 0px rgba(0,0,0,0.8); }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="relative">

    <div class="app-overlay"></div>

    <header class="bg-[#1f232f] p-4 shadow-lg z-50 flex justify-between items-center border-b-4 border-[#161922] shrink-0">
        <div class="flex items-center gap-2" onclick="goHome()">
            <span class="text-3xl text-yellow-400 drop-shadow-strong">‚ú¥Ô∏è</span>
            <div>
                <h1 class="text-lg font-black leading-none text-white tracking-wide drop-shadow-md uppercase text-shadow">T√ÅCTICA ROYALE</h1>
                <p class="text-[10px] text-gray-400 font-bold tracking-widest uppercase">FAN-HUB 2026</p>
            </div>
        </div>
        <div id="edit-indicator" class="hidden bg-yellow-500 text-black px-2 py-0.5 rounded text-[10px] font-black animate-pulse">MODO EDICI√ìN</div>
    </header>

    <main id="app-content" class="flex-1 overflow-y-auto no-scrollbar relative pb-safe">
        
        <div id="view-home" class="p-6 flex flex-col h-full justify-center gap-5 overflow-hidden">
            <div class="text-center">
                <div class="inline-block bg-[#1f232f]/90 backdrop-blur p-5 rounded-3xl border-4 border-[#3d4658] shadow-2xl">
                    <p class="text-gray-400 text-xs uppercase font-black mb-1">Win Rate (Top 2)</p>
                    <h2 id="home-winrate" class="text-6xl font-black text-green-400 drop-shadow-strong">-%</h2>
                </div>
            </div>
            
            <button onclick="goToAddMatch()" class="clash-btn bg-yellow-500 text-white w-full px-6 py-5 rounded-2xl shadow-xl flex items-center justify-center gap-3 group hover:scale-[1.02] active:scale-100 transition-transform cursor-pointer">
                <span class="text-4xl drop-shadow-strong group-hover:rotate-12 transition-transform shrink-0">‚öîÔ∏è</span>
                <span class="text-xl sm:text-2xl font-black uppercase text-shadow truncate">Registrar Partida</span>
            </button>
            
            <div class="grid grid-cols-2 gap-4">
                <button onclick="goToHistory()" class="clash-btn bg-blue-600 text-white py-3 rounded-xl font-bold flex flex-col items-center border-blue-800 hover:scale-[1.02] active:scale-100 transition-transform cursor-pointer"><span class="text-2xl mb-1 drop-shadow-strong">üìú</span> HISTORIAL</button>
                <button onclick="goToStats()" class="clash-btn bg-purple-600 text-white py-3 rounded-xl font-bold flex flex-col items-center border-purple-800 hover:scale-[1.02] active:scale-100 transition-transform cursor-pointer"><span class="text-2xl mb-1 drop-shadow-strong">üìä</span> BIG DATA</button>
            </div>
            <div class="grid grid-cols-3 gap-3 sm:gap-4">
                <button onclick="goToLeaderGuide()" class="clash-btn bg-orange-600 text-white py-3 rounded-xl font-bold text-[10px] uppercase border-orange-800 hover:scale-[1.02] active:scale-100 transition-transform cursor-pointer">L√≠deres</button>
                <button onclick="goToAttrGuide()" class="clash-btn bg-gray-600 text-white py-3 rounded-xl font-bold text-[10px] uppercase border-gray-800 hover:scale-[1.02] active:scale-100 transition-transform cursor-pointer">Atributos</button>
                <button onclick="goToModGuide()" class="clash-btn bg-green-600 text-white py-3 rounded-xl font-bold text-[10px] uppercase border-green-800 hover:scale-[1.02] active:scale-100 transition-transform cursor-pointer">MODIF.</button>
            </div>

            <div class="text-center opacity-80 hover:opacity-100 transition-opacity bg-black/20 rounded-xl p-3 backdrop-blur-sm mt-2">
                <p class="text-[9px] text-gray-400 font-bold tracking-widest uppercase mb-0.5">Dise√±ada y desarrollada por</p>
                <p class="text-xs text-yellow-500 font-black tracking-widest mb-2">JUAN LUIS VALVERDE</p>
                <div class="flex justify-center gap-8">
                    <a href="https://www.linkedin.com/in/juanluis-valverde/" target="_blank" class="text-2xl text-white hover:text-blue-400 transition-all drop-shadow-md hover:scale-110"><i class="bi bi-linkedin"></i></a>
                    <a href="https://www.behance.net/estudiosventorrillo" target="_blank" class="text-2xl text-white hover:text-blue-200 transition-all drop-shadow-md hover:scale-110"><i class="bi bi-behance"></i></a>
                    <a href="https://www.instagram.com/estudiosventorrillo/?hl=es" target="_blank" class="text-2xl text-white hover:text-pink-400 transition-all drop-shadow-md hover:scale-110"><i class="bi bi-instagram"></i></a>
                </div>
            </div>
        </div>

        <div id="view-form" class="hidden pb-32">
            <div class="sticky-header p-4 flex justify-center items-center"><h2 id="form-title" class="text-2xl font-black uppercase text-center text-shadow">Registrar Partida</h2></div>
            <div class="p-4">
                <section class="mb-4 text-center bg-black/20 p-3 rounded-2xl backdrop-blur-sm">
                    <h3 class="text-white font-black mb-4 uppercase text-shadow">Tu Resultado</h3>
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="selectRank(1)" class="rank-btn clash-btn rank-1 rounded-xl p-4 font-black text-shadow hover:scale-105 transition-transform" data-rank="1">1¬∫</button>
                        <button onclick="selectRank(2)" class="rank-btn clash-btn rank-2 rounded-xl p-4 font-black text-shadow hover:scale-105 transition-transform" data-rank="2">2¬∫</button>
                        <button onclick="selectRank(3)" class="rank-btn clash-btn rank-3 rounded-xl p-4 font-black text-shadow hover:scale-105 transition-transform" data-rank="3">3¬∫</button>
                        <button onclick="selectRank(4)" class="rank-btn clash-btn rank-4 rounded-xl p-4 font-black text-shadow hover:scale-105 transition-transform" data-rank="4">4¬∫</button>
                    </div>
                </section>

                <section class="mb-8 bg-black/20 p-3 rounded-2xl backdrop-blur-sm">
                    <h3 class="text-green-400 font-black text-center mb-4 uppercase text-shadow">Modificador</h3>
                    <div id="grid-match-mod" class="grid grid-cols-3 gap-2 max-h-48 overflow-y-auto p-1"></div>
                </section>

                <section class="mb-8 bg-black/20 p-3 rounded-2xl backdrop-blur-sm">
                    <h3 class="text-yellow-400 font-black text-center mb-4 uppercase text-shadow">Tu L√≠der</h3>
                    <div id="grid-my-leader" class="grid grid-cols-3 gap-3"></div>
                </section>
                
                <section class="mb-8 bg-black/20 p-3 rounded-2xl backdrop-blur-sm">
                    <h3 class="text-red-400 font-black text-center mb-2 uppercase text-shadow">Rivales (En orden de posici√≥n)</h3>
                    <div id="selected-rivals-bar" class="flex justify-center gap-2 mb-4 h-16 bg-black/40 rounded-xl p-2 border border-white/5"></div>
                    <div id="grid-rivals" class="grid grid-cols-3 gap-2"></div>
                </section>
                
                <section class="mb-8 bg-black/20 p-3 rounded-2xl backdrop-blur-sm">
                    <h3 class="text-blue-400 font-black text-center mb-2 uppercase text-shadow">Tu Equipo</h3>
                    <div id="selected-squad-bar" class="grid grid-cols-6 gap-2 mb-4 h-14 bg-black/40 rounded-xl p-2 border border-white/5"></div>
                    <div id="active-synergies" class="flex flex-wrap gap-1 mb-4 justify-center"></div>
                    <div id="grid-troops" class="grid grid-cols-4 gap-2 max-h-[40vh] overflow-y-auto p-1 bg-black/40 rounded-xl border border-white/5"></div>
                </section>
            </div>
            
            <div class="fixed bottom-0 left-0 w-full p-4 pb-safe bg-[#1f232f]/95 backdrop-blur flex gap-2 z-50 border-t border-gray-600 shadow-2xl">
                <button onclick="cancelEdit()" class="clash-btn bg-gray-600 w-1/4 py-4 rounded-xl font-black border-gray-800 hover:scale-105 transition-transform">‚úñ</button>
                <button onclick="saveMatch()" class="clash-btn bg-green-500 flex-1 py-4 rounded-xl text-xl font-black border-green-700 text-shadow hover:scale-105 transition-transform">GUARDAR</button>
            </div>
        </div>

        <div id="view-history" class="hidden pb-20"><div class="sticky-header p-4 flex items-center gap-3"><span onclick="goHome()" class="text-3xl cursor-pointer drop-shadow-strong hover:scale-110 transition-transform">‚¨ÖÔ∏è</span><h2 class="text-2xl font-black uppercase text-shadow">HISTORIAL</h2></div><div id="history-list" class="space-y-3 p-4"></div></div>
        <div id="view-stats" class="hidden pb-24"><div class="sticky-header p-4 flex items-center gap-3"><span onclick="goHome()" class="text-3xl cursor-pointer drop-shadow-strong hover:scale-110 transition-transform">‚¨ÖÔ∏è</span><h2 class="text-2xl font-black uppercase text-shadow">BIG DATA</h2></div><div class="p-4 space-y-8">
            <div class="bg-[#1f232f]/90 p-6 rounded-3xl border border-gray-600 shadow-xl">
                <h3 class="text-xs font-black text-gray-400 uppercase mb-4 text-center">Rendimiento √öltimas 20</h3>
                <div class="flex justify-around items-end h-48 gap-3 px-2 relative" id="stats-chart"></div>
                <div class="flex justify-around mt-3 px-2 text-xs font-black text-gray-400"><span>1¬∫</span><span>2¬∫</span><span>3¬∫</span><span>4¬∫</span></div>
            </div>
            <div id="stats-leader-usage"></div>
            <div id="stats-analysis" class="space-y-3"></div>
            <div id="stats-mod-correl"></div>
            <div id="stats-vs-leaders"></div>
            <div id="stats-elixir-curve"></div>
            <div id="stats-chars" class="space-y-3 pb-8"></div>
        </div></div>
        <div id="view-guide-leaders" class="hidden pb-20"><div class="sticky-header p-4 flex items-center gap-3"><span onclick="goHome()" class="text-3xl cursor-pointer drop-shadow-strong hover:scale-110 transition-transform">‚¨ÖÔ∏è</span><h2 class="text-2xl font-black uppercase text-shadow">L√çDERES</h2></div><div id="guide-leaders-list" class="space-y-4 p-4"></div></div>
        <div id="view-guide-attrs" class="hidden pb-20"><div class="sticky-header p-4 flex items-center gap-3"><span onclick="goHome()" class="text-3xl cursor-pointer drop-shadow-strong hover:scale-110 transition-transform">‚¨ÖÔ∏è</span><h2 class="text-2xl font-black uppercase text-shadow">ATRIBUTOS</h2></div><div id="guide-attrs-list" class="space-y-4 p-4"></div></div>
        <div id="view-guide-mods" class="hidden pb-20"><div class="sticky-header p-4 flex items-center gap-3"><span onclick="goHome()" class="text-3xl cursor-pointer drop-shadow-strong hover:scale-110 transition-transform">‚¨ÖÔ∏è</span><h2 class="text-2xl font-black uppercase text-shadow">MODIFICADORES</h2></div><div id="guide-mods-list" class="space-y-4 p-4"></div></div>

        <div id="welcome-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur hidden">
            <div class="bg-[#1f232f] border-4 border-yellow-500 rounded-3xl p-6 max-w-md w-full shadow-2xl relative">
                <h2 class="text-2xl font-black text-center text-yellow-400 uppercase mb-4 text-shadow drop-shadow-md">¬°Bienvenido a tu Tracker!</h2>
                <div class="space-y-4 text-sm text-gray-200 leading-relaxed text-center">
                    <p>Esta es tu herramienta definitiva para dominar <strong>T√°ctica Royale</strong>.</p>
                    <ul class="text-left bg-black/30 p-4 rounded-xl space-y-2 border border-white/10">
                        <li>üëë <strong>Historial:</strong> Guarda tus partidas y revisa tus composiciones.</li>
                        <li>üìä <strong>Big Data:</strong> Descubre qu√© sinergias y tropas te dan m√°s victorias.</li>
                        <li>üèÜ <strong>Mejora:</strong> Analiza tus errores y sube a Top 1.</li>
                    </ul>
                </div>
                <button onclick="closeWelcome()" class="clash-btn bg-yellow-500 text-black w-full py-4 rounded-xl font-black mt-6 text-lg hover:scale-105 transition-transform">¬°ENTENDIDO!</button>
            </div>
        </div>

        <div id="update-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur hidden">
            <div class="bg-[#1f232f] border-4 border-green-500 rounded-3xl p-6 max-w-md w-full shadow-2xl relative">
                <div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-green-500 text-black px-4 py-1 rounded-full font-black text-xs">NUEVA VERSI√ìN v9.2</div>
                <h2 class="text-2xl font-black text-center text-white uppercase mb-4 text-shadow drop-shadow-md">¬°Actualizaci√≥n Lista! ‚öîÔ∏è</h2>
                <div class="space-y-4 text-sm text-gray-200 leading-relaxed text-center">
                    <p class="font-bold text-green-400">¬°Sinergias, Modificadores y An√°lisis PRO!</p>
                    <p class="text-xs text-gray-300">Hemos corregido los errores de visualizaci√≥n en Big Data y a√±adido nuevas m√©tricas de experto.</p>
                </div>
                <button onclick="closeUpdate()" class="clash-btn bg-green-500 text-white w-full py-4 rounded-xl font-black mt-6 text-lg hover:scale-105 transition-transform">¬°A POR EL TOP!</button>
            </div>
        </div>
    </main>

    <script>
        // --- DATA ---
        const LEADERS = [
            { id: 'rey_royale', name: 'Rey Royale', icon: 'üëë', color: 'bg-yellow-600', skill: 'Tributo Real', desc: 'Recibes 4-8 de elixir al perder una ronda.' },
            { id: 'emperatriz', name: 'Emperatriz', icon: '‚ú®', color: 'bg-pink-600', skill: 'Previsi√≥n de Fusi√≥n', desc: 'Ganas +1 de elixir por cada combinaci√≥n (merge) de tropas.' },
            { id: 'reina_duende', name: 'Reina Duende', icon: 'üë∫', color: 'bg-green-700', skill: 'Sonrisa Envenenada', desc: '33% de probabilidad de generar un duende gratis al eliminar una tropa enemiga.' },
            { id: 'loong', name: 'Loong de Elixir', icon: 'üêâ', color: 'bg-orange-500', skill: 'Dulce Primavera', desc: 'Otorga +1 de elixir por ronda y permite tener una unidad extra en el tablero.' },
            { id: 'maquina', name: 'M√°quina B√©lica', icon: '‚öôÔ∏è', color: 'bg-gray-600', skill: 'Maestro de la Construcci√≥n', desc: 'Genera estructuras defensivas gratis en rondas clave, pero pierdes 1 hueco en tu equipo.' },
            { id: 'guia_eco', name: 'Gu√≠a del Eco', icon: 'üßò‚Äç‚ôÇÔ∏è', color: 'bg-blue-600', skill: 'Clon Servicial', desc: 'Proyecta un eco que noquea a los enemigos cercanos tras cargar su barra.' }
        ];

        const ATTRIBUTES = [
            { id: 'as', name: 'As', icon: '‚ô†Ô∏è', color: 'bg-blue-900', c2: 'Capit√°n gana +40% da√±o y cura 40% del da√±o infligido.', c4: 'Capit√°n gana +70% da√±o y cura 70% del da√±o infligido.' },
            { id: 'asesino', name: 'Asesino', icon: 'üó°Ô∏è', color: 'bg-purple-600', c2: 'Atacan a la retaguardia enemiga. +30% probabilidad y da√±o cr√≠tico.', c4: 'Atacan a la retaguardia enemiga. +60% probabilidad y da√±o cr√≠tico.' },
            { id: 'bruto', name: 'Bruto', icon: 'üí™', color: 'bg-orange-700', c2: '+30% Vel. Ataque. Tras 4 marcas, el enemigo pierde 20% vida.', c4: '+60% Vel. Ataque. Tras 4 marcas, el enemigo pierde 40% vida.' },
            { id: 'clan', name: 'Clan', icon: 'üè∞', color: 'bg-blue-400', c2: 'Al 50% vida, se curan r√°pido un 35% y vel. +35%.', c4: 'Al 50% vida, se curan r√°pido un 70% y vel. +70%.' },
            { id: 'destructor', name: 'Destructor', icon: 'üéØ', color: 'bg-red-700', c2: '+1 Alcance. +10% da√±o por hex√°gono de distancia.', c4: '+1 Alcance. +15% da√±o por hex√°gono de distancia.' },
            { id: 'duende', name: 'Duende', icon: 'üë∫', color: 'bg-green-600', c2: 'Obtienes un duende extra aleatorio de 2 o 3 de elixir gratis.', c4: 'Obtienes un duende extra aleatorio de 3 o 4 de elixir gratis.' },
            { id: 'gigante', name: 'Gigante', icon: 'üóø', color: 'bg-yellow-800', c2: 'Los gigantes reciben un 40% menos de da√±o.', c4: 'M√°ximo 2 personajes disponibles.' },
            { id: 'luchador', name: 'Luchador', icon: 'ü•ä', color: 'bg-orange-500', c2: 'Ganan +50% de vida m√°xima extra.', c4: 'Ganan +100% de vida m√°xima extra.' },
            { id: 'muerto', name: 'Muerto Viviente', icon: 'üíÄ', color: 'bg-gray-800', c2: '2 enemigos con m√°s vida reciben maldici√≥n (-25% vida m√°x). Gan√°is +30% da√±o extra.', c4: '3 enemigos con m√°s vida reciben maldici√≥n (-50% vida m√°x). Gan√°is +30% da√±o extra.' },
            { id: 'noble', name: 'Noble', icon: 'üëë', color: 'bg-yellow-500', c2: 'Vanguardia -25% da√±o / Retaguardia +25% da√±o.', c4: 'Vanguardia -40% da√±o / Retaguardia +40% da√±o.' },
            { id: 'pekka', name: 'Pekka', icon: 'ü§ñ', color: 'bg-indigo-900', c2: '+40% de da√±o y se curan un 60% de la vida de la tropa derrotada.', c4: 'M√°ximo 2 personajes disponibles.' },
            { id: 'super', name: 'Superestrella', icon: '‚ú®', color: 'bg-pink-500', c2: 'Barra de habilidad empieza cargada al 1/3. 50% chance repetir.', c4: 'Barra de habilidad cargada al 2/3. 50% chance repetir.' },
            { id: 'tirador', name: 'Tirador', icon: 'üèπ', color: 'bg-red-500', c2: '+10% Vel. Ataque con cada golpe (M√°x 25).', c4: '+15% Vel. Ataque con cada golpe (M√°x 25).' }
        ];

        const MODIFIERS = [
            { id: 'c_dano', name: 'Casilla de Da√±o', rank: 'Bronce II', icon: 'üí•', desc: 'Aparecen 2 casillas que reducen a la mitad el HP pero otorgan da√±o extra.' },
            { id: 'recolector', name: 'Estructura: Recolector', rank: 'Bronce II', icon: 'üß™', desc: 'Consigue un recolector de elixir de 3 estrellas en la ronda 5.' },
            { id: 'ventaja_e', name: 'Ventaja por Estrella', rank: 'Bronce III', icon: '‚≠ê', desc: 'Las tropas con m√°s estrellas infligen m√°s da√±o y reciben menos de las inferiores.' },
            { id: 'invita', name: 'Invita la Casa', rank: 'Bronce III', icon: 'üè†', desc: 'La primera tropa que compras en cada turno es gratis.' },
            { id: 'ballesta', name: 'Estructura: Ballesta', rank: 'Plata I', icon: 'üèπ', desc: 'Consigue una ballesta de 3 estrellas en la ronda 5.' },
            { id: 'dominio', name: 'Dominio', rank: 'Plata I', icon: 'üìà', desc: 'Las tropas de 3 y 4 estrellas obtienen puntos de vida y da√±o adicionales.' },
            { id: 'c_inmune', name: 'Casilla de Inmunidad', rank: 'Plata II', icon: 'üõ°Ô∏è', desc: '2 casillas vuelven inmunes al da√±o durante 5 segundos a las tropas.' },
            { id: 'infernal', name: 'Estructura: Infernal', rank: 'Plata II', icon: 'üî•', desc: 'Consigue una torre infernal de 3 estrellas en la ronda 5.' },
            { id: 'perteneces', name: 'Ahora me perteneces', rank: 'Plata III', icon: 'ü§ù', desc: 'Ganar√°s una copia de 1 estrella de la primera tropa enemiga que derrotes.' },
            { id: 'eco_banco', name: 'Eco del Banco', icon: 'üè¶', rank: 'Plata III', desc: 'Cada ronda ganas una copia de 1 estrella de la tropa m√°s a la derecha en tu banco.' },
            { id: 'negocios', name: 'Negocios Fruct√≠feros', rank: 'Oro I', icon: 'üí∞', desc: 'Por cada tropa que vendas ganas +1 de elixir en la siguiente ronda.' },
            { id: 'c_clon', name: 'Casilla de Clonaci√≥n', rank: 'Oro I', icon: 'üë•', desc: '2 casillas crean copias de las tropas con el 70% de vida.' },
            { id: 'mortero', name: 'Estructura: Mortero', rank: 'Oro II', icon: 'üí£', desc: 'Consigue un mortero de 3 estrellas en la ronda 5.' },
            { id: 'medida', name: 'Dise√±ada a Medida', rank: 'Oro II', icon: 'üìè', desc: 'Cada ronda, gana una tropa adecuada para tu equipo.' },
            { id: 'bonus_c', name: 'Bonus por Combinaci√≥n', rank: 'Oro III', icon: '‚ûï', desc: 'Al combinar recibes una tropa b√°sica de 1 estrella.' },
            { id: 'tesla', name: 'Estructura: Tesla', rank: 'Oro III', icon: '‚ö°', desc: 'Consigue una torre tesla de 3 estrellas en la ronda 5.' },
            { id: 'prioritaria', name: 'Opci√≥n Prioritaria', rank: 'Diamante', icon: 'üé´', desc: 'La primera tropa que compres en cada turno es de 2 estrellas.' },
            { id: 'c_salto', name: 'Casilla de Salto', rank: 'Diamante', icon: 'üöÄ', desc: '2 casillas permiten a las tropas saltar hasta el lado del rival.' }
        ];

        const TROOPS = [
            { id: 1, name: 'Duendes', cost: 2, attrs: ['duende', 'asesino'] },
            { id: 2, name: 'D. Lanza', cost: 2, attrs: ['duende', 'destructor'] },
            { id: 3, name: 'Mini Pekka', cost: 2, attrs: ['pekka', 'bruto'] },
            { id: 4, name: 'B√°rbaros', cost: 2, attrs: ['clan', 'luchador'] },
            { id: 5, name: 'D. Esq.', cost: 2, attrs: ['tirador', 'muerto'] },
            { id: 6, name: 'Mago', cost: 2, attrs: ['clan', 'destructor'] },
            { id: 7, name: 'G. Noble', cost: 2, attrs: ['gigante', 'tirador'] },
            { id: 8, name: 'Mosquetera', cost: 3, attrs: ['noble', 'super'] },
            { id: 9, name: 'Valquiria', cost: 3, attrs: ['clan', 'bruto'] },
            { id: 10, name: 'Pekka', cost: 3, attrs: ['pekka', 'luchador'] },
            { id: 11, name: 'Pr√≠ncipe', cost: 3, attrs: ['noble', 'luchador'] },
            { id: 12, name: 'Lanzadardos', cost: 3, attrs: ['duende', 'tirador'] },
            { id: 13, name: 'G. Elec.', cost: 3, attrs: ['gigante', 'super'] },
            { id: 14, name: 'Verdugo', cost: 3, attrs: ['as', 'destructor'] },
            { id: 15, name: 'Bruja', cost: 4, attrs: ['muerto', 'super'] },
            { id: 16, name: 'Princesa', cost: 4, attrs: ['noble', 'destructor'] },
            { id: 17, name: 'Megacab.', cost: 4, attrs: ['as', 'luchador'] },
            { id: 18, name: 'F. Real', cost: 4, attrs: ['muerto', 'asesino'] },
            { id: 19, name: 'Bandida', cost: 4, attrs: ['as', 'asesino'] },
            { id: 20, name: 'M. Duende', cost: 4, attrs: ['duende', 'bruto'] },
            { id: 21, name: 'R. Esq.', cost: 5, attrs: ['muerto', 'bruto'] },
            { id: 22, name: 'C. Dorado', cost: 5, attrs: ['noble', 'asesino'] },
            { id: 23, name: 'R. Arq.', cost: 5, attrs: ['clan', 'tirador'] },
            { id: 24, name: 'Monje', cost: 5, attrs: ['as', 'super'] }
        ];

        const CURRENT_KEY = 'crt_v92_data';
        const OLD_KEY = 'crt_v91_data';
        if (!localStorage.getItem(CURRENT_KEY) && localStorage.getItem(OLD_KEY)) localStorage.setItem(CURRENT_KEY, localStorage.getItem(OLD_KEY));

        let draft = { leader: null, rivals: [], squad: [], rank: null, modifier: null };
        let matchHistory = JSON.parse(localStorage.getItem(CURRENT_KEY)) || [];
        let editingIdx = null;

        document.addEventListener('DOMContentLoaded', () => { 
            if (!localStorage.getItem('crt_welcome_shown_v9')) document.getElementById('welcome-modal').classList.remove('hidden'); 
            else if (!localStorage.getItem('crt_v92_update_notified')) document.getElementById('update-modal').classList.remove('hidden');
            updateHomeStats();
        });

        function closeWelcome() { document.getElementById('welcome-modal').classList.add('hidden'); localStorage.setItem('crt_welcome_shown_v9', 'true'); if (!localStorage.getItem('crt_v92_update_notified')) document.getElementById('update-modal').classList.remove('hidden'); }
        function closeUpdate() { document.getElementById('update-modal').classList.add('hidden'); localStorage.setItem('crt_v92_update_notified', 'true'); }
        function navigate(id) { document.querySelectorAll('main > div').forEach(div => div.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); window.scrollTo(0, 0); }
        function goHome() { editingIdx = null; document.getElementById('edit-indicator').classList.add('hidden'); updateHomeStats(); navigate('view-home'); }
        function cancelEdit() { if(editingIdx !== null) goToHistory(); else goHome(); }

        function renderFormInputs() {
            document.getElementById('grid-match-mod').innerHTML = MODIFIERS.map(m => `<div onclick="setMatchMod('${m.id}', this)" class="mod-opt clash-btn bg-gray-800 rounded-xl p-2 flex flex-col items-center h-20 ${draft.modifier === m.id ? 'selected-mod' : ''} border-2 border-white/10 hover:scale-105 transition-transform cursor-pointer"><span class="text-xl drop-shadow-strong">${m.icon}</span><span class="text-[7px] font-black uppercase mt-1 text-center text-gray-300 leading-none">${m.name}</span></div>`).join('');
            document.getElementById('grid-my-leader').innerHTML = LEADERS.map(l => `<div onclick="setMyLeader('${l.id}', this)" class="l-opt clash-btn ${l.color} rounded-xl p-2 flex flex-col items-center h-24 ${draft.leader === l.id ? 'selected-leader' : ''} border-2 border-white/20 hover:scale-105 transition-transform cursor-pointer"><span class="text-3xl drop-shadow-strong">${l.icon}</span><span class="text-[9px] font-black uppercase mt-1 text-center text-shadow">${l.name}</span></div>`).join('');
            document.getElementById('grid-rivals').innerHTML = LEADERS.map(l => `<div onclick="addRival('${l.id}')" class="clash-btn bg-gray-800 rounded-lg p-2 flex flex-col items-center h-16 border-2 border-gray-600 hover:scale-105 transition-transform cursor-pointer"><span class="text-xl drop-shadow-strong">${l.icon}</span><span class="text-[8px] font-bold text-gray-400 mt-1">${l.name}</span></div>`).join('');
            document.getElementById('grid-troops').innerHTML = TROOPS.map(t => `<div onclick="addTroop(${t.id})" class="clash-btn bg-elixir-${t.cost} rounded-lg p-1 flex flex-col items-center justify-center h-16 shadow-md border-b-4 hover:scale-105 transition-transform cursor-pointer"><div class="text-[9px] font-black text-center text-white text-shadow leading-tight">${t.name}</div><div class="flex gap-1 mt-1">${t.attrs.map(aId => `<span class="text-[12px] drop-shadow-strong">${ATTRIBUTES.find(x => x.id === aId).icon}</span>`).join('')}</div></div>`).join('');
            updateRivalsBar(); updateSquadUI();
        }

        function setMatchMod(id, el) { draft.modifier = id; document.querySelectorAll('.mod-opt').forEach(opt => opt.classList.remove('selected-mod')); el.classList.add('selected-mod'); }
        function setMyLeader(id, el) { draft.leader = id; document.querySelectorAll('.l-opt').forEach(opt => opt.classList.remove('selected-leader')); el.classList.add('selected-leader'); }
        function addRival(id) { if (draft.rivals.length < 3) { draft.rivals.push(id); updateRivalsBar(); } }
        function removeRival(i) { draft.rivals.splice(i, 1); updateRivalsBar(); }
        
        function updateRivalsBar() { 
            const availableRanks = [1, 2, 3, 4].filter(r => r !== draft.rank);
            document.getElementById('selected-rivals-bar').innerHTML = draft.rivals.map((id, i) => {
                const leader = LEADERS.find(x => x.id === id);
                return `<div onclick="removeRival(${i})" class="${leader.color} w-12 h-12 rounded-full flex flex-col items-center justify-center text-xl shadow-lg border-2 border-white/30 hover:scale-105 transition-transform cursor-pointer relative"><span class="drop-shadow-strong">${leader.icon}</span><span class="absolute -top-1 -right-1 bg-black text-[8px] px-1 rounded border border-white/20">${availableRanks[i] || '?'}¬∫</span></div>`;
            }).join('') || `<span class="text-gray-400 text-[10px] italic">A√±ade 3 rivales en orden de llegada</span>`; 
        }

        function addTroop(id) { if (draft.squad.length < 6) { draft.squad.push({...TROOPS.find(x => x.id === id)}); updateSquadUI(); } }
        function removeTroop(i) { draft.squad.splice(i, 1); updateSquadUI(); }

        function updateSquadUI() {
            document.getElementById('selected-squad-bar').innerHTML = draft.squad.map((t, i) => `<div onclick="removeTroop(${i})" class="bg-blue-900/60 rounded flex items-center justify-center text-[8px] font-black text-center p-1 border border-blue-400/30 text-shadow hover:scale-105 transition-transform cursor-pointer leading-tight">${t.name}</div>`).join('');
            const counts = {}; const uniqueTroopIds = new Set();
            draft.squad.forEach(t => { if (!uniqueTroopIds.has(t.id)) { uniqueTroopIds.add(t.id); t.attrs.forEach(a => counts[a] = (counts[a]||0)+1); } });
            document.getElementById('active-synergies').innerHTML = Object.entries(counts).map(([aId, count]) => {
                const a = ATTRIBUTES.find(x => x.id === aId);
                return `<div class="px-2 py-0.5 rounded-full ${a.color} text-[9px] font-bold border border-white/20 ${count >= 2 ? 'ring-2 ring-white scale-105' : 'opacity-60'}"><span class="drop-shadow-strong">${a.icon}</span> ${count}</div>`;
            }).join('');
        }

        function selectRank(rank) { draft.rank = rank; document.querySelectorAll('.rank-btn').forEach(btn => { btn.classList.remove('ring-4', 'ring-white', 'scale-110'); if (parseInt(btn.dataset.rank) === rank) btn.classList.add('ring-4', 'ring-white', 'scale-110'); }); updateRivalsBar(); }
        function saveMatch() { if (!draft.leader || !draft.rank) return alert("¬°Datos incompletos!"); if (editingIdx !== null) matchHistory[editingIdx] = { ...draft, date: matchHistory[editingIdx].date }; else { draft.date = new Date().toISOString(); matchHistory.push({ ...draft }); } localStorage.setItem(CURRENT_KEY, JSON.stringify(matchHistory)); goHome(); }
        function updateHomeStats() { const top2 = matchHistory.filter(m => m.rank <= 2).length; const rate = matchHistory.length ? Math.round((top2/matchHistory.length)*100) : 0; const el = document.getElementById('home-winrate'); el.innerText = `${rate}%`; el.className = `text-6xl font-black drop-shadow-strong ${rate >= 50 ? 'text-green-400' : 'text-red-400'}`; }
        function goToAddMatch() { editingIdx = null; draft = { leader: null, rivals: [], squad: [], rank: null, modifier: null }; selectRank(null); navigate('view-form'); renderFormInputs(); }
        function goToHistory() { navigate('view-history'); renderHistory(); }
        function goToLeaderGuide() { navigate('view-guide-leaders'); renderLGuide(); }
        function goToAttrGuide() { navigate('view-guide-attrs'); renderAGuide(); }
        function goToModGuide() { navigate('view-guide-mods'); renderMGuide(); }
        
        function renderHistory() { 
            document.getElementById('history-list').innerHTML = [...matchHistory].reverse().map((m, i) => { 
                const realIdx = matchHistory.length - 1 - i;
                const leader = LEADERS.find(x => x.id === m.leader);
                const mod = m.modifier ? MODIFIERS.find(x => x.id === m.modifier) : null;
                const counts = {}; const uniqueIds = new Set();
                m.squad.forEach(t => { if(!uniqueIds.has(t.id)) { uniqueIds.add(t.id); t.attrs.forEach(a => counts[a] = (counts[a]||0)+1); } });
                const activeBadges = Object.entries(counts).filter(([_, c]) => c >= 2).map(([aId, c]) => {
                    const a = ATTRIBUTES.find(x => x.id === aId);
                    return `<span class="inline-flex items-center gap-1 ${a.color} px-1.5 py-0.5 rounded-full text-[9px] font-bold shadow-sm border border-white/20"><span class="drop-shadow-strong">${a.icon}</span> ${c}</span>`;
                }).join('');
                return `<div class="bg-[#1f232f]/90 p-4 rounded-2xl border-l-8 rank-${m.rank} flex justify-between items-center shadow-lg backdrop-blur-sm"><div class="flex items-center gap-4"><div class="relative"><div class="${leader.color} w-14 h-14 rounded-2xl flex items-center justify-center text-4xl shadow-inner border border-white/10"><span class="drop-shadow-strong">${leader.icon}</span></div><div class="absolute -top-2 -right-2 bg-gray-900 text-white text-[10px] font-black px-1.5 py-0.5 rounded border border-gray-600">#${m.rank}</div></div><div><div class="text-[10px] text-white font-black uppercase tracking-wider drop-shadow-md text-shadow">${new Date(m.date).toLocaleDateString()} ${mod ? `| ${mod.icon}` : ''}</div><div class="flex flex-wrap gap-1 mt-1.5 min-h-[20px]">${activeBadges || '<span class="text-[10px] text-gray-400 italic">Sin sinergias</span>'}</div></div></div><div class="flex gap-2"><button onclick="editMatch(${realIdx})" class="p-2 bg-blue-900/30 text-blue-400 rounded-lg border border-blue-500/30 hover:bg-blue-900/50 transition-colors"><i class="bi bi-gear-fill"></i></button><button onclick="deleteMatch(${realIdx})" class="p-2 bg-red-900/30 text-red-400 rounded-lg border border-red-500/30 hover:bg-red-900/50 transition-colors"><i class="bi bi-trash-fill"></i></button></div></div>`; 
            }).join(''); 
        }

        function goToStats() {
            const last20 = matchHistory.slice(-20);
            if (!last20.length) return navigate('view-stats');

            const rankCounts = {1:0, 2:0, 3:0, 4:0};
            const attrStats = {}; const troopStats = {}; 
            const myLeaderUsage = {}; const vsLeaderStats = {};
            const modCorrelations = {}; const elixirCurve = {total: 0, wins: 0, count: 0};

            last20.forEach(m => {
                rankCounts[m.rank]++;
                myLeaderUsage[m.leader] = (myLeaderUsage[m.leader] || 0) + 1;
                
                // Elixir Promedio
                const avgElixir = m.squad.reduce((sum, t) => sum + t.cost, 0) / (m.squad.length || 1);
                elixirCurve.total += avgElixir;
                if(m.rank <= 2) { elixirCurve.wins += avgElixir; elixirCurve.count++; }

                const matchAttrs = new Set(); const uniqueIds = new Set();
                m.squad.forEach(t => { 
                    if(!uniqueIds.has(t.id)) { 
                        uniqueIds.add(t.id); 
                        t.attrs.forEach(a => { 
                            if(!attrStats[a]) attrStats[a] = {1:0,2:0,3:0,4:0}; 
                            attrStats[a][m.rank]++; 
                            matchAttrs.add(a); 
                        }); 
                        if(!troopStats[t.id]) troopStats[t.id] = {wins:0, total:0};
                        troopStats[t.id].total++; if(m.rank <= 2) troopStats[t.id].wins++;
                    }
                });

                if(m.modifier) {
                    if(!modCorrelations[m.modifier]) modCorrelations[m.modifier] = {};
                    matchAttrs.forEach(aId => {
                        if(!modCorrelations[m.modifier][aId]) modCorrelations[m.modifier][aId] = {wins:0, total:0};
                        modCorrelations[m.modifier][aId].total++; if(m.rank <= 2) modCorrelations[m.modifier][aId].wins++;
                    });
                }

                const availableRanks = [1, 2, 3, 4].filter(r => r !== m.rank);
                if (m.rivals) m.rivals.forEach((rivalId, idx) => { 
                    if(!vsLeaderStats[rivalId]) vsLeaderStats[rivalId] = {winsVs: 0, totalVs: 0}; 
                    vsLeaderStats[rivalId].totalVs++; if(m.rank < availableRanks[idx]) vsLeaderStats[rivalId].winsVs++; 
                });
            });

            // RENDERING
            const chartHtml = [1,2,3,4].map(r => { 
                const height = (rankCounts[r] / last20.length) * 100 || 0; 
                return `<div class="bar-container w-16 relative bg-gray-800 rounded-t-lg border border-gray-600 group" title="Partidas: ${rankCounts[r]}"><div class="w-full rank-${r} rounded-t-lg absolute bottom-0 transition-all duration-1000 ease-out" style="height: ${height}%"></div><span class="absolute -top-6 w-full text-center text-xs font-black z-10 text-shadow group-hover:scale-125 transition-transform">${rankCounts[r]}</span></div>`; 
            }).join('');
            document.getElementById('stats-chart').innerHTML = `<div class="chart-grid" style="bottom: 25%"></div><div class="chart-grid" style="bottom: 50%"></div><div class="chart-grid" style="bottom: 75%"></div>${chartHtml}`;

            let htmlUsage = `<h3 class="text-xs font-black text-gray-400 uppercase px-2 mb-2">Uso de L√≠deres (√öltimas 20)</h3><div class="grid grid-cols-2 gap-2">`;
            Object.entries(myLeaderUsage).sort((a,b) => b[1] - a[1]).forEach(([lId, count]) => { const l = LEADERS.find(x => x.id === lId); const wins = last20.filter(m => m.leader === lId && m.rank <= 2).length; const wr = Math.round((wins/count)*100); htmlUsage += `<div class="bg-black/40 p-3 rounded-xl border border-white/10 flex items-center gap-2"><span class="text-xl">${l.icon}</span><div><p class="text-[10px] font-black text-white uppercase leading-none">${count} partidas</p><p class="text-[9px] text-green-400 font-bold">${wr}% WR</p></div></div>`; });
            document.getElementById('stats-leader-usage').innerHTML = htmlUsage + `</div>`;

            let htmlAttr = `<h3 class="text-xs font-black text-gray-400 uppercase px-2 mb-2">Dominio de Sinergias (min 2)</h3>`;
            [1,2,3,4].forEach(rank => {
                const bestAttrId = Object.keys(attrStats).sort((a,b) => attrStats[b][rank] - attrStats[a][rank])[0];
                if(bestAttrId && attrStats[bestAttrId][rank] > 0) {
                    const a = ATTRIBUTES.find(x => x.id === bestAttrId);
                    htmlAttr += `<div class="bg-white/5 p-3 rounded-2xl border border-white/10 flex justify-between items-center"><div class="flex items-center gap-2"><span class="text-xl drop-shadow-strong">${a.icon}</span> <div class="text-[9px] font-black uppercase">M√°s com√∫n en ${rank}¬∫<p class="text-white text-xs">${a.name}</p></div></div><div class="text-right"><p class="font-black text-lg ${rank <= 2 ? 'text-green-400' : 'text-red-400'}">${attrStats[bestAttrId][rank]}</p><p class="text-[8px] text-gray-500 uppercase leading-none">VECES</p></div></div>`;
                }
            });
            document.getElementById('stats-analysis').innerHTML = htmlAttr;

            let htmlMod = `<h3 class="text-xs font-black text-gray-400 uppercase px-2 mb-2">Sinergia TOP por Modificador</h3><div class="grid grid-cols-1 gap-2">`;
            Object.entries(modCorrelations).forEach(([mId, attrs]) => {
                const mod = MODIFIERS.find(x => x.id === mId);
                const bestAttrEntry = Object.entries(attrs).sort((a,b) => (b[1].wins/b[1].total) - (a[1].wins/a[1].total))[0];
                const attr = ATTRIBUTES.find(x => x.id === bestAttrEntry[0]);
                const wr = Math.round((bestAttrEntry[1].wins/bestAttrEntry[1].total)*100);
                htmlMod += `<div class="bg-black/40 p-3 rounded-xl border border-white/10 flex justify-between items-center"><div class="flex items-center gap-2"><span class="text-lg">${mod.icon}</span><span class="text-[9px] uppercase font-bold text-gray-400">${mod.name}</span></div><div class="flex items-center gap-2 font-black text-xs text-shadow"><span class="${attr.color} px-2 py-0.5 rounded-full border border-white/20">${attr.icon} ${attr.name}</span> <span class="text-green-400">${wr}% WR</span></div></div>`;
            });
            document.getElementById('stats-mod-correl').innerHTML = (Object.keys(modCorrelations).length ? htmlMod + `</div>` : '');

            let htmlVs = `<h3 class="text-xs font-black text-gray-400 uppercase px-2 mb-2">Win Rate vs L√≠deres Rivales</h3><div class="grid grid-cols-2 gap-2">`;
            Object.entries(vsLeaderStats).sort((a,b) => (b[1].winsVs/b[1].totalVs) - (a[1].winsVs/a[1].totalVs)).forEach(([rId, data]) => {
                const l = LEADERS.find(x => x.id === rId); const wr = Math.round((data.winsVs / data.totalVs) * 100);
                htmlVs += `<div class="bg-white/5 p-2 rounded-xl flex items-center justify-between px-3 border border-white/5"><div class="flex items-center gap-2"><span class="text-lg">${l.icon}</span><span class="text-[9px] font-black uppercase text-gray-400">${l.name}</span></div><span class="text-xs font-black ${wr >= 50 ? 'text-green-400' : 'text-red-400'}">${wr}%</span></div>`;
            });
            document.getElementById('stats-vs-leaders').innerHTML = htmlVs + `</div>`;

            // M√©trica E-Sports
            const winCurve = elixirCurve.count ? (elixirCurve.wins / elixirCurve.count).toFixed(1) : "-";
            document.getElementById('stats-elixir-curve').innerHTML = `
            <div class="bg-blue-900/40 p-4 rounded-3xl border border-blue-500/30 backdrop-blur-sm">
                <p class="text-[10px] font-black text-blue-400 uppercase mb-1">Curva de Elixir Ganadora (E-Sports Analytica)</p>
                <div class="flex items-center gap-3">
                    <span class="text-3xl">üß™</span>
                    <div>
                        <p class="text-xl font-black text-white">${winCurve} Elixir Medio</p>
                        <p class="text-[9px] text-blue-200">Este es el coste promedio de tus equipos en el Top 2.</p>
                    </div>
                </div>
            </div>`;

            let htmlChar = `<h3 class="text-xs font-black text-gray-400 uppercase px-2 mb-2">Tus Fichajes Estrella</h3>`;
            const sortedTroops = Object.keys(troopStats).sort((a,b) => (troopStats[b].wins/troopStats[b].total) - (troopStats[a].wins/troopStats[a].total));
            if(sortedTroops.length) {
                const mvp = TROOPS.find(x => x.id == sortedTroops[0]);
                const toxic = TROOPS.find(x => x.id == sortedTroops[sortedTroops.length-1]);
                htmlChar += `<div class="bg-green-900/40 p-4 rounded-2xl border border-green-500/50 flex justify-between items-center"><div class="flex items-center gap-3"><span class="text-3xl drop-shadow-strong">üèÜ</span><div><p class="text-[9px] font-black text-green-400 uppercase">MVP (WR ${Math.round((troopStats[mvp.id].wins/troopStats[mvp.id].total)*100)}%)</p><p class="font-bold text-white text-shadow uppercase">${mvp.name}</p></div></div></div>`;
                if(sortedTroops.length > 1) htmlChar += `<div class="bg-red-900/40 p-4 rounded-2xl border border-red-500/50 flex justify-between items-center mt-2"><div class="flex items-center gap-3"><span class="text-3xl drop-shadow-strong">üíÄ</span><div><p class="text-[9px] font-black text-red-400 uppercase">T√≥xico (Loss ${100 - Math.round((troopStats[toxic.id].wins/troopStats[toxic.id].total)*100)}%)</p><p class="font-bold text-white text-shadow uppercase">${toxic.name}</p></div></div></div>`;
            }
            document.getElementById('stats-chars').innerHTML = htmlChar;

            navigate('view-stats');
        }

        function renderLGuide() { document.getElementById('guide-leaders-list').innerHTML = LEADERS.map(l => `<div class="bg-[#1f232f]/95 p-4 rounded-2xl border border-gray-600 shadow-lg"><div class="flex items-center gap-4 mb-3"><div class="${l.color} w-12 h-12 rounded-xl flex items-center justify-center text-3xl border border-white/20"><span class="drop-shadow-strong">${l.icon}</span></div><div><h3 class="font-black text-white uppercase text-lg text-shadow">${l.name}</h3><p class="text-yellow-400 text-xs font-bold italic">${l.skill}</p></div></div><p class="text-sm text-gray-300 leading-relaxed">${l.desc}</p></div>`).join(''); }
        function renderAGuide() { document.getElementById('guide-attrs-list').innerHTML = ATTRIBUTES.map(a => `<div class="bg-[#1f232f]/95 p-4 rounded-2xl border border-gray-600 shadow-lg relative overflow-hidden"><div class="flex items-center gap-3 mb-4"><div class="${a.color} w-10 h-10 rounded-lg flex items-center justify-center text-xl border border-white/20"><span class="drop-shadow-strong">${a.icon}</span></div><h3 class="font-black text-white uppercase text-shadow">${a.name}</h3></div><div class="grid grid-cols-1 gap-3"><div class="bg-black/40 p-3 rounded-xl border border-white/5"><span class="text-[10px] font-black text-gray-400 uppercase tracking-widest block mb-1">2 Unidades</span><p class="text-xs text-gray-300">${a.c2}</p></div><div class="bg-black/40 p-3 rounded-xl border border-white/5"><span class="text-[10px] font-black text-yellow-500 uppercase tracking-widest block mb-1">4 Unidades</span><p class="text-xs text-gray-300">${a.c4}</p></div></div></div>`).join(''); }
        function renderMGuide() { document.getElementById('guide-mods-list').innerHTML = MODIFIERS.map(m => `<div class="bg-[#1f232f]/95 p-4 rounded-2xl border border-gray-600 shadow-lg"><div class="flex items-center gap-3 mb-3"><div class="bg-gray-700 w-12 h-12 rounded-xl flex items-center justify-center text-2xl border border-white/10"><span class="drop-shadow-strong">${m.icon}</span></div><div><h3 class="font-black text-white uppercase text-shadow">${m.name}</h3><p class="text-green-400 text-[10px] font-black uppercase tracking-widest">${m.rank}</p></div></div><p class="text-xs text-gray-300 leading-relaxed">${m.desc}</p></div>`).join(''); }
        
        function editMatch(idx) { editingIdx = idx; draft = JSON.parse(JSON.stringify(matchHistory[idx])); document.getElementById('form-title').innerText = "Editar Registro"; document.getElementById('edit-indicator').classList.remove('hidden'); navigate('view-form'); renderFormInputs(); selectRank(draft.rank); }
        function deleteMatch(idx) { if(confirm('¬øBorrar?')) { matchHistory.splice(idx, 1); localStorage.setItem(CURRENT_KEY, JSON.stringify(matchHistory)); renderHistory(); } }
        updateHomeStats();
    </script>
</body>
</html>
